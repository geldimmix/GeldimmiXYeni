@model Nobetci.Web.Models.CleaningViewModel
@{
    ViewData["Title"] = Model.IsTurkish ? "Temizlik √áizelgesi" : "Cleaning Schedule";
    Layout = "~/Views/Shared/_AppLayout.cshtml";
    var isTurkish = Model.IsTurkish;
}

<div class="cleaning-page">
    <!-- Header -->
    <div class="cleaning-header">
        <div class="header-info">
            <!-- Module Selector -->
            <div class="module-dropdown">
                <select id="moduleSelect" class="module-select" onchange="switchModule(this.value)">
                    <option value="shift">üè• @(isTurkish ? "N√∂bet Sistemi" : "Shift System")</option>
                    <option value="cleaning" selected>üßπ @(isTurkish ? "Temizlik √áizelgesi" : "Cleaning Schedule")</option>
                    <option value="qrmenu">üçΩÔ∏è @(isTurkish ? "QR Men√º" : "QR Menu")</option>
                </select>
            </div>
            <p class="header-subtitle">
                @(isTurkish ? "√áizelgelerinizi y√∂netin, QR kod ile temizlik takibi yapƒ±n" : "Manage schedules, track cleaning with QR codes")
            </p>
        </div>
        <div class="header-actions">
            <button class="btn-dashboard" onclick="showDailyDashboard()">
                <span>üìä</span>
                @(isTurkish ? "G√ºnl√ºk Durum" : "Daily Status")
            </button>
            <button class="btn-pending @(Model.PendingRecordsCount > 0 ? "has-pending" : "")" onclick="showPendingRecords()">
                <span>‚è≥</span>
                @(isTurkish ? "Onay Bekleyen" : "Pending")
                @if (Model.PendingRecordsCount > 0)
                {
                    <span class="badge">@Model.PendingRecordsCount</span>
                }
            </button>
        </div>
    </div>

    <!-- Limits Bar -->
    <div class="limits-bar">
        <div class="limit-item">
            <span class="limit-icon">üìã</span>
            <span class="limit-label">@(isTurkish ? "√áizelge" : "Schedules")</span>
            <span class="limit-value">@Model.ScheduleCount / @(Model.Limits.MaxSchedules == 100 ? "‚àû" : Model.Limits.MaxSchedules.ToString())</span>
        </div>
        <div class="limit-item">
            <span class="limit-icon">üì±</span>
            <span class="limit-label">@(isTurkish ? "Aylƒ±k QR Eri≈üim" : "Monthly QR Access")</span>
            <span class="limit-value">@Model.MonthlyQrAccessCount / @Model.Limits.MaxQrAccessPerMonth</span>
        </div>
        @if (!Model.Limits.CanSelectFrequency)
        {
            <div class="limit-item warning">
                <span class="limit-icon">‚ö†Ô∏è</span>
                <span class="limit-label">@(isTurkish ? "Sadece g√ºnl√ºk frekans" : "Daily frequency only")</span>
            </div>
        }
    </div>

    <!-- Schedules Grid -->
    <div class="schedules-section">
        <div class="section-header">
            <h2>@(isTurkish ? "√áizelgelerim" : "My Schedules")</h2>
            @if (Model.CanAddSchedule)
            {
                <button class="btn-add" onclick="showAddScheduleModal()">
                    <span>+</span> @(isTurkish ? "Yeni √áizelge" : "New Schedule")
                </button>
            }
        </div>

        @if (Model.Schedules.Any())
        {
            <div class="schedules-grid">
                @foreach (var schedule in Model.Schedules)
                {
                    <div class="schedule-card" data-id="@schedule.Id">
                        <div class="card-header">
                            <h3>@schedule.Name</h3>
                            <div class="card-actions">
                                <button class="btn-icon" onclick="showQrCode(@schedule.Id, '@schedule.QrAccessCode')" title="QR Kod">üì±</button>
                                <button class="btn-icon" onclick="editSchedule(@schedule.Id)" title="@(isTurkish ? "D√ºzenle" : "Edit")">‚úèÔ∏è</button>
                                <button class="btn-icon danger" onclick="deleteSchedule(@schedule.Id)" title="@(isTurkish ? "Sil" : "Delete")">üóëÔ∏è</button>
                            </div>
                        </div>
                        @if (!string.IsNullOrEmpty(schedule.Location))
                        {
                            <div class="card-location">üìç @schedule.Location</div>
                        }
                        <div class="card-stats">
                            <span class="stat">
                                <span class="stat-icon">üìù</span>
                                @schedule.Items.Count @(isTurkish ? "madde" : "items")
                            </span>
                            @if (!string.IsNullOrEmpty(schedule.CleanerName))
                            {
                                <span class="stat">
                                    <span class="stat-icon">üë§</span>
                                    @schedule.CleanerName
                                </span>
                            }
                            @if (!string.IsNullOrEmpty(schedule.AccessCode))
                            {
                                <span class="stat protected">
                                    <span class="stat-icon">üîí</span>
                                    @(isTurkish ? "≈ûifreli" : "Protected")
                                </span>
                            }
                        </div>
                        <div class="card-footer">
                            <button class="btn-items" onclick="manageItems(@schedule.Id)">
                                @(isTurkish ? "Maddeleri Y√∂net" : "Manage Items")
                            </button>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="empty-icon">üßπ</div>
                <h3>@(isTurkish ? "Hen√ºz √ßizelge yok" : "No schedules yet")</h3>
                <p>@(isTurkish ? "ƒ∞lk temizlik √ßizelgenizi olu≈üturun" : "Create your first cleaning schedule")</p>
                @if (Model.CanAddSchedule)
                {
                    <button class="btn-primary" onclick="showAddScheduleModal()">
                        @(isTurkish ? "√áizelge Olu≈ütur" : "Create Schedule")
                    </button>
                }
            </div>
        }
    </div>
</div>

<!-- Add/Edit Schedule Modal -->
<div class="modal fade" id="scheduleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="scheduleModalTitle">@(isTurkish ? "Yeni √áizelge" : "New Schedule")</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="scheduleId">
                <div class="form-group">
                    <label>@(isTurkish ? "√áizelge Adƒ±" : "Schedule Name") *</label>
                    <input type="text" id="scheduleName" class="form-control" placeholder="@(isTurkish ? "√∂rn: Tuvalet Temizliƒüi" : "e.g. Restroom Cleaning")">
                </div>
                <div class="form-group">
                    <label>@(isTurkish ? "Konum" : "Location")</label>
                    <input type="text" id="scheduleLocation" class="form-control" placeholder="@(isTurkish ? "√∂rn: 1. Kat" : "e.g. 1st Floor")">
                </div>
                <div class="form-group">
                    <label>@(isTurkish ? "Eri≈üim ≈ûifresi (4-6 karakter)" : "Access Code (4-6 chars)")</label>
                    <input type="text" id="scheduleAccessCode" class="form-control" maxlength="6" placeholder="@(isTurkish ? "Bo≈ü bƒ±rakƒ±labilir" : "Optional")">
                </div>
                <hr>
                <div class="form-group">
                    <label>@(isTurkish ? "Temizlik G√∂revlisi Adƒ±" : "Cleaner Name")</label>
                    <input type="text" id="cleanerName" class="form-control">
                </div>
                <div class="form-group">
                    <label>@(isTurkish ? "Temizlik G√∂revlisi Telefonu" : "Cleaner Phone")</label>
                    <input type="text" id="cleanerPhone" class="form-control">
                </div>
                @if (Model.IsPremium && Model.Limits.CanGroupSchedules && Model.Groups.Any())
                {
                    <div class="form-group">
                        <label>@(isTurkish ? "Grup" : "Group")</label>
                        <select id="scheduleGroup" class="form-control">
                            <option value="">@(isTurkish ? "Grupsuz" : "No Group")</option>
                            @foreach (var g in Model.Groups)
                            {
                                <option value="@g.Id">@g.Name</option>
                            }
                        </select>
                    </div>
                }
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@(isTurkish ? "ƒ∞ptal" : "Cancel")</button>
                <button type="button" class="btn btn-primary" onclick="saveSchedule()">@(isTurkish ? "Kaydet" : "Save")</button>
            </div>
        </div>
    </div>
</div>

<!-- Items Modal -->
<div class="modal fade" id="itemsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@(isTurkish ? "√áizelge Maddeleri" : "Schedule Items")</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="currentScheduleId">
                <div class="items-header">
                    <span id="itemCount">0</span> / <span id="itemLimit">@Model.Limits.MaxItemsPerSchedule</span> @(isTurkish ? "madde" : "items")
                    <button class="btn-add-item" id="addItemBtn" onclick="showAddItemForm()">
                        + @(isTurkish ? "Madde Ekle" : "Add Item")
                    </button>
                </div>
                
                <!-- Add Item Form (hidden by default) -->
                <div id="addItemForm" class="add-item-form" style="display:none;">
                    <div class="form-row">
                        <div class="form-group flex-grow">
                            <input type="text" id="newItemName" class="form-control" placeholder="@(isTurkish ? "Madde adƒ±" : "Item name")">
                        </div>
                        @if (Model.Limits.CanSelectFrequency)
                        {
                            <div class="form-group">
                                <select id="newItemFrequency" class="form-control">
                                    <option value="0">@(isTurkish ? "G√ºnl√ºk" : "Daily")</option>
                                    <option value="1">@(isTurkish ? "Haftalƒ±k" : "Weekly")</option>
                                    <option value="2">@(isTurkish ? "Aylƒ±k" : "Monthly")</option>
                                    <option value="3">@(isTurkish ? "Yƒ±llƒ±k" : "Yearly")</option>
                                    <option value="4">@(isTurkish ? "√ñzel" : "Custom")</option>
                                </select>
                            </div>
                            <div class="form-group" id="customDaysGroup" style="display:none;">
                                <input type="number" id="newItemDays" class="form-control" min="1" placeholder="@(isTurkish ? "G√ºn" : "Days")">
                            </div>
                        }
                        <button class="btn-save-item" onclick="saveItem()">‚úì</button>
                        <button class="btn-cancel-item" onclick="hideAddItemForm()">‚úï</button>
                    </div>
                </div>
                
                <div id="itemsList" class="items-list"></div>
            </div>
        </div>
    </div>
</div>

<!-- QR Code Modal -->
<div class="modal fade" id="qrModal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@(isTurkish ? "QR Kod" : "QR Code")</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <div id="qrCodeContainer"></div>
                <p class="qr-url mt-3" id="qrUrl"></p>
                <button class="btn btn-outline-primary btn-sm" onclick="copyQrUrl()">
                    @(isTurkish ? "Linki Kopyala" : "Copy Link")
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Daily Dashboard Modal -->
<div class="modal fade" id="dashboardModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    üìä @(isTurkish ? "G√ºnl√ºk Temizlik Durumu" : "Daily Cleaning Status")
                    <span id="dashboardDate" class="text-muted ms-2" style="font-size: 0.85rem;"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Summary Stats -->
                <div class="dashboard-summary" id="dashboardSummary">
                    <div class="stat-card total">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-label">@(isTurkish ? "Toplam Madde" : "Total Items")</div>
                    </div>
                    <div class="stat-card completed">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value" id="statCompleted">0</div>
                        <div class="stat-label">@(isTurkish ? "Onaylandƒ±" : "Approved")</div>
                    </div>
                    <div class="stat-card pending">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-value" id="statPending">0</div>
                        <div class="stat-label">@(isTurkish ? "Bekliyor" : "Pending")</div>
                    </div>
                    <div class="stat-card notdone">
                        <div class="stat-icon">‚≠ï</div>
                        <div class="stat-value" id="statNotDone">0</div>
                        <div class="stat-label">@(isTurkish ? "Yapƒ±lmadƒ±" : "Not Done")</div>
                    </div>
                    <div class="stat-card rejected">
                        <div class="stat-icon">‚ùå</div>
                        <div class="stat-value" id="statRejected">0</div>
                        <div class="stat-label">@(isTurkish ? "Reddedildi" : "Rejected")</div>
                    </div>
                </div>
                
                <!-- Progress Bar -->
                <div class="dashboard-progress">
                    <div class="progress-bar-container">
                        <div class="progress-segment completed" id="progressCompleted" style="width: 0%"></div>
                        <div class="progress-segment pending" id="progressPending" style="width: 0%"></div>
                        <div class="progress-segment rejected" id="progressRejected" style="width: 0%"></div>
                    </div>
                    <div class="progress-percent" id="progressPercent">0%</div>
                </div>
                
                <!-- Schedules List -->
                <div id="dashboardSchedules"></div>
            </div>
        </div>
    </div>
</div>

<!-- Pending Records Modal -->
<div class="modal fade" id="pendingModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@(isTurkish ? "Onay Bekleyenler" : "Pending Approvals")</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="pendingList"></div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Module Dropdown - Compact & Elegant */
    .module-dropdown {
        margin-bottom: 12px;
    }
    
    .module-select {
        padding: 8px 28px 8px 12px;
        background: #1e293b;
        color: #f1f5f9 !important;
        border: 1px solid #334155;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        transition: all 0.15s ease;
    }
    
    .module-select:hover {
        background: #334155;
        border-color: #475569;
    }
    
    .module-select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }
    
    .module-select option {
        background: #1e293b !important;
        color: #f1f5f9 !important;
        padding: 8px;
    }
    
    .cleaning-page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 16px;
    }
    
    .cleaning-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .header-info h1 {
        font-size: 1.1rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .header-icon {
        font-size: 1.2rem;
    }
    
    .header-subtitle {
        color: #6b7280;
        margin: 2px 0 0 0;
        font-size: 0.8rem;
    }
    
    .header-actions {
        display: flex;
        gap: 8px;
    }
    
    .btn-back {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 6px 12px;
        background: #f3f4f6;
        color: #374151;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.8rem;
        transition: all 0.2s;
    }
    
    .btn-back:hover {
        background: #e5e7eb;
    }
    
    .btn-pending {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: #f3f4f6;
        color: #6b7280;
        border: none;
        border-radius: 6px;
        font-weight: 500;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-pending:hover {
        background: #e5e7eb;
    }
    
    .btn-pending.has-pending {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        color: #92400e;
        font-weight: 600;
        animation: pulse-pending 2s infinite;
    }
    
    .btn-pending.has-pending:hover {
        background: linear-gradient(135deg, #fde68a, #fcd34d);
    }
    
    @@keyframes pulse-pending {
        0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
        50% { box-shadow: 0 0 0 4px rgba(245, 158, 11, 0); }
    }
    
    .btn-pending .badge {
        background: #f59e0b;
        color: white;
        padding: 1px 6px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
    }
    
    .btn-dashboard {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        color: #1e40af;
        border: none;
        border-radius: 6px;
        font-weight: 500;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-dashboard:hover {
        background: linear-gradient(135deg, #bfdbfe, #93c5fd);
    }
    
    /* Dashboard Styles */
    .dashboard-summary {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    
    .stat-card {
        flex: 1;
        min-width: 100px;
        padding: 12px;
        border-radius: 10px;
        text-align: center;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
    }
    
    .stat-card.total { background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-color: #7dd3fc; }
    .stat-card.completed { background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-color: #86efac; }
    .stat-card.pending { background: linear-gradient(135deg, #fefce8, #fef9c3); border-color: #fde047; }
    .stat-card.notdone { background: linear-gradient(135deg, #f8fafc, #f1f5f9); border-color: #cbd5e1; }
    .stat-card.rejected { background: linear-gradient(135deg, #fef2f2, #fee2e2); border-color: #fca5a5; }
    
    .stat-icon { font-size: 1.5rem; margin-bottom: 4px; }
    .stat-value { font-size: 1.5rem; font-weight: 700; }
    .stat-label { font-size: 0.75rem; color: #64748b; }
    
    .stat-card.total .stat-value { color: #0369a1; }
    .stat-card.completed .stat-value { color: #16a34a; }
    .stat-card.pending .stat-value { color: #ca8a04; }
    .stat-card.notdone .stat-value { color: #64748b; }
    .stat-card.rejected .stat-value { color: #dc2626; }
    
    .dashboard-progress {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
    }
    
    .progress-bar-container {
        flex: 1;
        height: 12px;
        background: #e2e8f0;
        border-radius: 6px;
        overflow: hidden;
        display: flex;
    }
    
    .progress-segment {
        height: 100%;
        transition: width 0.3s ease;
    }
    
    .progress-segment.completed { background: #22c55e; }
    .progress-segment.pending { background: #eab308; }
    .progress-segment.rejected { background: #ef4444; }
    
    .progress-percent {
        font-size: 1rem;
        font-weight: 700;
        color: #22c55e;
        min-width: 50px;
        text-align: right;
    }
    
    .dashboard-schedule {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        margin-bottom: 12px;
        overflow: hidden;
    }
    
    .dashboard-schedule-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
        cursor: pointer;
    }
    
    .dashboard-schedule-header:hover {
        background: #f1f5f9;
    }
    
    .schedule-title {
        font-weight: 600;
        color: #1e293b;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .schedule-stats {
        display: flex;
        gap: 12px;
        font-size: 0.8rem;
    }
    
    .schedule-stat {
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .schedule-stat.done { color: #16a34a; }
    .schedule-stat.pending { color: #ca8a04; }
    .schedule-stat.notdone { color: #64748b; }
    
    .dashboard-items {
        padding: 12px 16px;
        display: none;
    }
    
    .dashboard-items.open {
        display: block;
    }
    
    .dashboard-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 12px;
        background: #f8fafc;
        border-radius: 6px;
        margin-bottom: 6px;
        font-size: 0.85rem;
    }
    
    .dashboard-item:last-child {
        margin-bottom: 0;
    }
    
    .dashboard-item.done { background: #f0fdf4; border-left: 3px solid #22c55e; }
    .dashboard-item.pending { background: #fefce8; border-left: 3px solid #eab308; }
    .dashboard-item.rejected { background: #fef2f2; border-left: 3px solid #ef4444; }
    .dashboard-item.notdone { background: #f8fafc; border-left: 3px solid #cbd5e1; }
    
    .item-name { font-weight: 500; color: #334155; }
    .item-status-badge {
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
    }
    
    .item-status-badge.done { background: #dcfce7; color: #16a34a; }
    .item-status-badge.pending { background: #fef9c3; color: #ca8a04; }
    .item-status-badge.rejected { background: #fee2e2; color: #dc2626; }
    .item-status-badge.notdone { background: #e2e8f0; color: #64748b; }
    
    /* Limits Bar */
    .limits-bar {
        display: flex;
        gap: 16px;
        padding: 10px 14px;
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        border-radius: 8px;
        margin-bottom: 14px;
        flex-wrap: wrap;
    }
    
    .limit-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.78rem;
    }
    
    .limit-item.warning {
        color: #d97706;
    }
    
    .limit-icon {
        font-size: 0.9rem;
    }
    
    .limit-label {
        color: #4b5563;
    }
    
    .limit-value {
        font-weight: 600;
        color: #1e40af;
        font-variant-numeric: tabular-nums;
    }
    
    /* Section */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    
    .section-header h2 {
        font-size: 1rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
    }
    
    .btn-add {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 6px 12px;
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-add:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    
    /* Schedules Grid */
    .schedules-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 12px;
    }
    
    .schedule-card {
        background: white;
        border-radius: 8px;
        padding: 12px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.06);
        border: 1px solid #e5e7eb;
        transition: all 0.2s;
    }
    
    .schedule-card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-color: #d1d5db;
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    
    .card-header h3 {
        font-size: 0.9rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
    }
    
    .card-actions {
        display: flex;
        gap: 2px;
    }
    
    .btn-icon {
        width: 26px;
        height: 26px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f3f4f6;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.2s;
    }
    
    .btn-icon:hover {
        background: #e5e7eb;
    }
    
    .btn-icon.danger:hover {
        background: #fee2e2;
    }
    
    .card-location {
        font-size: 0.75rem;
        color: #6b7280;
        margin-bottom: 8px;
    }
    
    .card-stats {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 10px;
    }
    
    .stat {
        display: flex;
        align-items: center;
        gap: 3px;
        font-size: 0.75rem;
        color: #4b5563;
    }
    
    .stat.protected {
        color: #059669;
    }
    
    .card-footer {
        padding-top: 8px;
        border-top: 1px solid #e5e7eb;
    }
    
    .btn-items {
        width: 100%;
        padding: 6px;
        background: #f8fafc;
        color: #475569;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-items:hover {
        background: #f1f5f9;
        border-color: #cbd5e1;
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 32px 16px;
        background: #f9fafb;
        border-radius: 8px;
        border: 1px dashed #d1d5db;
    }
    
    .empty-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }
    
    .empty-state h3 {
        color: #374151;
        margin: 0 0 6px 0;
        font-size: 1rem;
    }
    
    .empty-state p {
        color: #6b7280;
        margin: 0 0 14px 0;
        font-size: 0.85rem;
    }
    
    .btn-primary {
        padding: 8px 16px;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.85rem;
        cursor: pointer;
    }
    
    /* Modal Styles */
    .modal-content {
        border-radius: 8px;
        border: none;
    }
    
    .modal-header {
        padding: 12px 16px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .modal-title {
        font-size: 1rem;
        font-weight: 600;
    }
    
    .modal-body {
        padding: 14px 16px;
    }
    
    .modal-footer {
        padding: 10px 16px;
        border-top: 1px solid #e5e7eb;
    }
    
    .form-group {
        margin-bottom: 12px;
    }
    
    .form-group label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 4px;
        font-size: 0.85rem;
    }
    
    .form-control {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.85rem;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }
    
    /* Items Modal */
    .items-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 10px;
        border-bottom: 1px solid #e5e7eb;
        margin-bottom: 12px;
        color: #6b7280;
        font-size: 0.85rem;
    }
    
    .btn-add-item {
        padding: 6px 10px;
        background: #10b981;
        font-size: 0.8rem;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
    }
    
    .add-item-form {
        padding: 10px;
        background: #f0fdf4;
        border-radius: 6px;
        margin-bottom: 10px;
    }
    
    .form-row {
        display: flex;
        gap: 6px;
        align-items: center;
    }
    
    .flex-grow {
        flex: 1;
    }
    
    .btn-save-item, .btn-cancel-item {
        width: 30px;
        height: 30px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.95rem;
    }
    
    .btn-save-item {
        background: #10b981;
        color: white;
    }
    
    .btn-cancel-item {
        background: #f3f4f6;
        color: #6b7280;
    }
    
    .items-list {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    
    .item-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 12px;
        background: #f9fafb;
        border-radius: 6px;
    }
    
    .item-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .item-name {
        font-weight: 500;
        color: #1f2937;
        font-size: 0.85rem;
    }
    
    .item-freq {
        font-size: 0.7rem;
        padding: 2px 6px;
        background: #dbeafe;
        color: #1e40af;
        border-radius: 4px;
    }
    
    .item-actions button {
        padding: 3px 6px;
        background: none;
        border: none;
        cursor: pointer;
        opacity: 0.6;
        font-size: 0.85rem;
    }
    
    .item-actions button:hover {
        opacity: 1;
    }
    
    /* QR Modal */
    #qrCodeContainer {
        padding: 12px;
        background: white;
        display: inline-block;
        border-radius: 6px;
    }
    
    .qr-url {
        font-size: 0.75rem;
        color: #6b7280;
        word-break: break-all;
    }
    
    /* Pending */
    .pending-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 12px;
        background: #fffbeb;
        border-radius: 6px;
        margin-bottom: 6px;
    }
    
    .pending-info h4 {
        margin: 0 0 2px 0;
        font-size: 0.9rem;
    }
    
    .pending-info p {
        margin: 0;
        font-size: 0.75rem;
        color: #6b7280;
    }
    
    .pending-actions {
        display: flex;
        gap: 6px;
    }
    
    .btn-approve {
        padding: 5px 10px;
        background: #10b981;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
    }
    
    .btn-reject {
        padding: 5px 10px;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
    }
    
    @@media (max-width: 768px) {
        .cleaning-page {
            padding: 12px;
        }
        
        .cleaning-header {
            flex-direction: column;
        }
        
        .limits-bar {
            flex-direction: column;
            gap: 8px;
        }
        
        .schedules-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script>
    const isTurkish = @(isTurkish ? "true" : "false");
    const canSelectFrequency = @(Model.Limits.CanSelectFrequency ? "true" : "false");
    const itemLimit = @Model.Limits.MaxItemsPerSchedule;
    let currentQrCode = '';
    
    // Module switcher
    function switchModule(module) {
        const routes = {
            'shift': '@Url.Action("Index", "App")',
            'cleaning': '@Url.Action("Index", "Cleaning")',
            'qrmenu': '@Url.Action("Index", "QrMenu")'
        };
        if (routes[module] && module !== 'cleaning') {
            window.location.href = routes[module];
        }
    }
    
    // Schedule Modal
    function showAddScheduleModal() {
        document.getElementById('scheduleId').value = '';
        document.getElementById('scheduleName').value = '';
        document.getElementById('scheduleLocation').value = '';
        document.getElementById('scheduleAccessCode').value = '';
        document.getElementById('cleanerName').value = '';
        document.getElementById('cleanerPhone').value = '';
        const groupSelect = document.getElementById('scheduleGroup');
        if (groupSelect) groupSelect.value = '';
        
        document.getElementById('scheduleModalTitle').textContent = isTurkish ? 'Yeni √áizelge' : 'New Schedule';
        new bootstrap.Modal(document.getElementById('scheduleModal')).show();
    }
    
    async function editSchedule(id) {
        try {
            const res = await fetch(`/api/cleaning/schedules/${id}`);
            const data = await res.json();
            
            document.getElementById('scheduleId').value = data.id;
            document.getElementById('scheduleName').value = data.name;
            document.getElementById('scheduleLocation').value = data.location || '';
            document.getElementById('scheduleAccessCode').value = data.accessCode || '';
            document.getElementById('cleanerName').value = data.cleanerName || '';
            document.getElementById('cleanerPhone').value = data.cleanerPhone || '';
            const groupSelect = document.getElementById('scheduleGroup');
            if (groupSelect) groupSelect.value = data.groupId || '';
            
            document.getElementById('scheduleModalTitle').textContent = isTurkish ? '√áizelgeyi D√ºzenle' : 'Edit Schedule';
            new bootstrap.Modal(document.getElementById('scheduleModal')).show();
        } catch (err) {
            alert(isTurkish ? 'Hata olu≈ütu' : 'An error occurred');
        }
    }
    
    async function saveSchedule() {
        const id = document.getElementById('scheduleId').value;
        const data = {
            name: document.getElementById('scheduleName').value,
            location: document.getElementById('scheduleLocation').value || null,
            accessCode: document.getElementById('scheduleAccessCode').value || null,
            cleanerName: document.getElementById('cleanerName').value || null,
            cleanerPhone: document.getElementById('cleanerPhone').value || null,
            groupId: document.getElementById('scheduleGroup')?.value || null
        };
        
        if (!data.name) {
            alert(isTurkish ? '√áizelge adƒ± gerekli' : 'Schedule name is required');
            return;
        }
        
        try {
            const url = id ? `/api/cleaning/schedules/${id}` : '/api/cleaning/schedules';
            const method = id ? 'PUT' : 'POST';
            
            const res = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const result = await res.json();
            if (result.error) {
                alert(result.error);
                return;
            }
            
            location.reload();
        } catch (err) {
            alert(isTurkish ? 'Hata olu≈ütu' : 'An error occurred');
        }
    }
    
    async function deleteSchedule(id) {
        if (!confirm(isTurkish ? 'Bu √ßizelgeyi silmek istediƒüinize emin misiniz?' : 'Are you sure you want to delete this schedule?')) {
            return;
        }
        
        try {
            await fetch(`/api/cleaning/schedules/${id}`, { method: 'DELETE' });
            location.reload();
        } catch (err) {
            alert(isTurkish ? 'Hata olu≈ütu' : 'An error occurred');
        }
    }
    
    // QR Code
    function showQrCode(id, qrCode) {
        currentQrCode = qrCode;
        const url = `${window.location.origin}/c/${qrCode}`;
        document.getElementById('qrUrl').textContent = url;
        
        const container = document.getElementById('qrCodeContainer');
        container.innerHTML = '';
        
        try {
            new QRCode(container, {
                text: url,
                width: 180,
                height: 180,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.M
            });
        } catch (error) {
            console.error('QR Code error:', error);
            container.innerHTML = '<p style="color: red;">' + (isTurkish ? 'QR kod olu≈üturulamadƒ±' : 'Failed to generate QR code') + '</p>';
        }
        
        new bootstrap.Modal(document.getElementById('qrModal')).show();
    }
    
    function copyQrUrl() {
        const url = document.getElementById('qrUrl').textContent;
        navigator.clipboard.writeText(url);
        alert(isTurkish ? 'Link kopyalandƒ±!' : 'Link copied!');
    }
    
    // Items
    async function manageItems(scheduleId) {
        document.getElementById('currentScheduleId').value = scheduleId;
        await loadItems(scheduleId);
        new bootstrap.Modal(document.getElementById('itemsModal')).show();
    }
    
    async function loadItems(scheduleId) {
        try {
            const res = await fetch(`/api/cleaning/schedules/${scheduleId}`);
            const data = await res.json();
            
            document.getElementById('itemCount').textContent = data.items.length;
            document.getElementById('addItemBtn').style.display = data.items.length >= itemLimit ? 'none' : 'block';
            
            const freqLabels = isTurkish 
                ? ['G√ºnl√ºk', 'Haftalƒ±k', 'Aylƒ±k', 'Yƒ±llƒ±k', '√ñzel']
                : ['Daily', 'Weekly', 'Monthly', 'Yearly', 'Custom'];
            
            const list = document.getElementById('itemsList');
            list.innerHTML = data.items.map(item => `
                <div class="item-row" data-id="${item.id}">
                    <div class="item-info">
                        <span class="item-name">${item.name}</span>
                        <span class="item-freq">${freqLabels[item.frequency]}${item.frequency === 4 ? ` (${item.frequencyDays} ${isTurkish ? 'g√ºn' : 'days'})` : ''}</span>
                    </div>
                    <div class="item-actions">
                        <button onclick="deleteItem(${item.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        } catch (err) {
            console.error(err);
        }
    }
    
    function showAddItemForm() {
        document.getElementById('addItemForm').style.display = 'block';
        document.getElementById('newItemName').focus();
    }
    
    function hideAddItemForm() {
        document.getElementById('addItemForm').style.display = 'none';
        document.getElementById('newItemName').value = '';
    }
    
    async function saveItem() {
        const scheduleId = document.getElementById('currentScheduleId').value;
        const name = document.getElementById('newItemName').value;
        const frequency = canSelectFrequency ? parseInt(document.getElementById('newItemFrequency')?.value || 0) : 0;
        const frequencyDays = frequency === 4 ? parseInt(document.getElementById('newItemDays')?.value || 1) : null;
        
        if (!name) {
            alert(isTurkish ? 'Madde adƒ± gerekli' : 'Item name is required');
            return;
        }
        
        try {
            const res = await fetch('/api/cleaning/items', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ scheduleId: parseInt(scheduleId), name, frequency, frequencyDays })
            });
            
            const result = await res.json();
            if (result.error) {
                alert(result.error);
                return;
            }
            
            hideAddItemForm();
            await loadItems(scheduleId);
        } catch (err) {
            alert(isTurkish ? 'Hata olu≈ütu' : 'An error occurred');
        }
    }
    
    async function deleteItem(id) {
        if (!confirm(isTurkish ? 'Bu maddeyi silmek istediƒüinize emin misiniz?' : 'Are you sure?')) return;
        
        try {
            await fetch(`/api/cleaning/items/${id}`, { method: 'DELETE' });
            const scheduleId = document.getElementById('currentScheduleId').value;
            await loadItems(scheduleId);
        } catch (err) {
            alert(isTurkish ? 'Hata olu≈ütu' : 'An error occurred');
        }
    }
    
    // Frequency change handler
    document.getElementById('newItemFrequency')?.addEventListener('change', function() {
        const customGroup = document.getElementById('customDaysGroup');
        if (customGroup) {
            customGroup.style.display = this.value === '4' ? 'block' : 'none';
        }
    });
    
    // Daily Dashboard
    async function showDailyDashboard() {
        try {
            const res = await fetch('/api/cleaning/dashboard/daily');
            const data = await res.json();
            
            // Update date
            const today = new Date();
            document.getElementById('dashboardDate').textContent = today.toLocaleDateString(isTurkish ? 'tr-TR' : 'en-US', {
                weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
            });
            
            // Update stats
            document.getElementById('statTotal').textContent = data.totalItems;
            document.getElementById('statCompleted').textContent = data.completedItems;
            document.getElementById('statPending').textContent = data.pendingItems;
            document.getElementById('statNotDone').textContent = data.notDoneItems;
            document.getElementById('statRejected').textContent = data.rejectedItems;
            
            // Update progress bar
            const total = data.totalItems || 1;
            const completedPct = (data.completedItems / total) * 100;
            const pendingPct = (data.pendingItems / total) * 100;
            const rejectedPct = (data.rejectedItems / total) * 100;
            
            document.getElementById('progressCompleted').style.width = completedPct + '%';
            document.getElementById('progressPending').style.width = pendingPct + '%';
            document.getElementById('progressRejected').style.width = rejectedPct + '%';
            document.getElementById('progressPercent').textContent = Math.round(completedPct) + '%';
            
            // Render schedules
            const container = document.getElementById('dashboardSchedules');
            if (data.schedules.length === 0) {
                container.innerHTML = `<p class="text-center text-muted">${isTurkish ? 'Hen√ºz √ßizelge yok' : 'No schedules yet'}</p>`;
            } else {
                container.innerHTML = data.schedules.map((s, idx) => `
                    <div class="dashboard-schedule">
                        <div class="dashboard-schedule-header" onclick="toggleDashboardSchedule(${idx})">
                            <div class="schedule-title">
                                <span>üìã</span>
                                <span>${s.name}</span>
                                ${s.location ? `<span class="text-muted" style="font-size: 0.8rem;">‚Ä¢ ${s.location}</span>` : ''}
                            </div>
                            <div class="schedule-stats">
                                <span class="schedule-stat done">‚úÖ ${s.completedCount}</span>
                                <span class="schedule-stat pending">‚è≥ ${s.pendingCount}</span>
                                <span class="schedule-stat notdone">‚≠ï ${s.notDoneCount}</span>
                            </div>
                        </div>
                        <div class="dashboard-items" id="dashboardItems${idx}">
                            ${s.items.map(item => {
                                let statusClass = 'notdone';
                                let statusText = isTurkish ? 'Yapƒ±lmadƒ±' : 'Not Done';
                                
                                if (item.status === 'completed') {
                                    statusClass = 'done';
                                    statusText = isTurkish ? 'Onaylandƒ±' : 'Approved';
                                } else if (item.status === 'pending') {
                                    statusClass = 'pending';
                                    statusText = isTurkish ? 'Bekliyor' : 'Pending';
                                } else if (item.status === 'rejected') {
                                    statusClass = 'rejected';
                                    statusText = isTurkish ? 'Reddedildi' : 'Rejected';
                                }
                                
                                return `
                                    <div class="dashboard-item ${statusClass}">
                                        <span class="item-name">${item.name}</span>
                                        <span class="item-status-badge ${statusClass}">${statusText}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `).join('');
            }
            
            new bootstrap.Modal(document.getElementById('dashboardModal')).show();
        } catch (err) {
            console.error(err);
            alert(isTurkish ? 'Bir hata olu≈ütu' : 'An error occurred');
        }
    }
    
    function toggleDashboardSchedule(idx) {
        const items = document.getElementById('dashboardItems' + idx);
        items.classList.toggle('open');
    }
    
    // Pending Records
    async function showPendingRecords() {
        try {
            const res = await fetch('/api/cleaning/records/pending');
            const records = await res.json();
            
            const list = document.getElementById('pendingList');
            if (records.length === 0) {
                list.innerHTML = `<p class="text-center text-muted">${isTurkish ? 'Onay bekleyen kayƒ±t yok' : 'No pending records'}</p>`;
            } else {
                list.innerHTML = records.map(r => `
                    <div class="pending-item" data-id="${r.id}">
                        <div class="pending-info">
                            <h4>${r.itemName}</h4>
                            <p>${r.scheduleName} ${r.scheduleLocation ? '‚Ä¢ ' + r.scheduleLocation : ''}</p>
                            <p>${r.completedByName || '-'} ‚Ä¢ ${new Date(r.completedAt).toLocaleString()}</p>
                        </div>
                        <div class="pending-actions">
                            <button class="btn-approve" onclick="approveRecord(${r.id})">‚úì ${isTurkish ? 'Onayla' : 'Approve'}</button>
                            <button class="btn-reject" onclick="rejectRecord(${r.id})">‚úï ${isTurkish ? 'Reddet' : 'Reject'}</button>
                        </div>
                    </div>
                `).join('');
            }
            
            new bootstrap.Modal(document.getElementById('pendingModal')).show();
        } catch (err) {
            console.error(err);
        }
    }
    
    async function approveRecord(id) {
        try {
            await fetch(`/api/cleaning/records/${id}/approve`, { method: 'POST' });
            document.querySelector(`.pending-item[data-id="${id}"]`)?.remove();
            location.reload();
        } catch (err) {
            alert(isTurkish ? 'Hata olu≈ütu' : 'An error occurred');
        }
    }
    
    async function rejectRecord(id) {
        const note = prompt(isTurkish ? 'Red sebebi (opsiyonel):' : 'Rejection reason (optional):');
        
        try {
            await fetch(`/api/cleaning/records/${id}/reject`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ note })
            });
            document.querySelector(`.pending-item[data-id="${id}"]`)?.remove();
            location.reload();
        } catch (err) {
            alert(isTurkish ? 'Hata olu≈ütu' : 'An error occurred');
        }
    }
</script>

