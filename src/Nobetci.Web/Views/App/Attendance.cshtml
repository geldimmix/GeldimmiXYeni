@model AttendanceViewModel
@{
    var isTurkish = System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName == "tr";
    ViewData["Title"] = isTurkish ? "Mesai Takip" : "Attendance";
    Layout = "_AppLayout";
    
    var dayNames = isTurkish 
        ? new[] { "Paz", "Pzt", "Sal", "√áar", "Per", "Cum", "Cmt" }
        : new[] { "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" };
        
    // Get shift templates for the modal
    var shiftTemplates = ViewBag.ShiftTemplates as List<Nobetci.Web.Data.Entities.ShiftTemplate> ?? new List<Nobetci.Web.Data.Entities.ShiftTemplate>();
}

<style>
    .att-page {
        min-height: calc(100vh - 60px);
        background: #f4f6f8;
        padding: 20px;
    }

    /* Header */
    .att-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 12px;
    }

    .att-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1a1a2e;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .att-nav {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .month-picker {
        display: flex;
        align-items: center;
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
    }

    .month-picker a {
        padding: 8px 12px;
        color: #666;
        text-decoration: none;
        transition: background 0.15s;
    }

    .month-picker a:hover {
        background: #f5f5f5;
    }

    .month-picker .month-text {
        padding: 8px 16px;
        font-weight: 600;
        color: #1a1a2e;
        min-width: 130px;
        text-align: center;
        border-left: 1px solid #e0e0e0;
        border-right: 1px solid #e0e0e0;
    }

    .btn-back {
        padding: 8px 16px;
        background: #fff;
        color: #333;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.85rem;
        transition: all 0.15s;
    }

    .btn-back:hover {
        background: #f5f5f5;
    }

    /* Table */
    .att-card {
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #e0e0e0;
    }

    .att-scroll {
        overflow-x: auto;
    }

    .att-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
    }

    .att-table th {
        background: #fafafa;
        padding: 12px 8px;
        font-weight: 600;
        color: #666;
        border-bottom: 2px solid #e0e0e0;
        text-align: center;
    }

    .att-table th.emp-col {
        position: sticky;
        left: 0;
        z-index: 20;
        background: #f5f5f5;
        min-width: 150px;
        text-align: left;
        padding-left: 16px;
    }

    .att-table th.day-col {
        min-width: 90px;
    }

    .day-num {
        font-size: 0.95rem;
        font-weight: 700;
        color: #1a1a2e;
    }

    .day-name {
        font-size: 0.65rem;
        color: #999;
    }

    .day-col.weekend { background: #fff5f5; }
    .day-col.weekend .day-num { color: #e53935; }
    .day-col.holiday { background: #fffde7; }
    .day-col.holiday .day-num { color: #f9a825; }

    .att-table td {
        padding: 0;
        border-bottom: 1px solid #f0f0f0;
        vertical-align: top;
    }

    .att-table td.emp-cell {
        position: sticky;
        left: 0;
        background: #fff;
        z-index: 5;
        padding: 10px 16px;
        border-right: 1px solid #e0e0e0;
    }

    .att-table tr:hover td.emp-cell {
        background: #fafafa;
    }

    .emp-name {
        font-weight: 600;
        color: #1a1a2e;
    }

    .emp-role {
        font-size: 0.7rem;
        color: #999;
    }

    /* Cell */
    .att-cell {
        min-width: 90px;
        min-height: 80px;
        cursor: pointer;
        transition: background 0.1s;
        border-right: 1px solid #f5f5f5;
    }

    .att-cell:hover {
        background: #f0f7ff;
    }

    .att-cell.weekend { background: #fff5f5; }
    .att-cell.weekend:hover { background: #ffebee; }
    .att-cell.holiday { background: #fffde7; }
    .att-cell.holiday:hover { background: #fff9c4; }

    .cell-inner {
        padding: 6px;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    /* N√∂bet Saatleri - Belirgin */
    .shift-box {
        background: #e3f2fd;
        border: 1px solid #90caf9;
        border-radius: 6px;
        padding: 4px 6px;
        text-align: center;
        margin-bottom: 4px;
    }

    .shift-label {
        font-size: 0.55rem;
        color: #1565c0;
        text-transform: uppercase;
        font-weight: 600;
    }

    .shift-time {
        font-size: 0.75rem;
        font-weight: 700;
        color: #0d47a1;
    }

    /* Giri≈ü/√áƒ±kƒ±≈ü Saatleri - Vurgulu */
    .attendance-box {
        display: flex;
        flex-direction: column;
        gap: 3px;
    }

    .time-row {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .time-row.check-in {
        background: #e8f5e9;
        border-left: 3px solid #4caf50;
        color: #2e7d32;
    }

    .time-row.check-out {
        background: #fce4ec;
        border-left: 3px solid #e91e63;
        color: #c2185b;
    }

    .time-row .icon {
        font-size: 0.7rem;
    }

    /* √áalƒ±≈üƒ±lan Saat */
    .worked-box {
        background: #f3e5f5;
        border-radius: 4px;
        padding: 2px 6px;
        text-align: center;
        margin-top: auto;
    }

    .worked-box span {
        font-size: 0.7rem;
        font-weight: 700;
        color: #7b1fa2;
    }

    /* Bo≈ü h√ºcre */
    .empty-hint {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ccc;
        font-size: 1.2rem;
    }

    .att-cell:hover .empty-hint {
        color: #2196f3;
    }

    /* √ñzet s√ºtunu */
    .summary-cell {
        text-align: center;
        padding: 10px !important;
        background: #fafafa;
    }

    .summary-hours {
        font-size: 1rem;
        font-weight: 700;
        color: #1a1a2e;
    }

    .summary-days {
        font-size: 0.7rem;
        color: #999;
    }

    /* Modal - Sade */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.4);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal-box {
        background: #fff;
        border-radius: 12px;
        width: 100%;
        max-width: 400px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    .modal-header {
        padding: 16px 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-header h3 {
        font-size: 1rem;
        font-weight: 600;
        color: #1a1a2e;
        margin: 0;
    }

    .modal-header small {
        color: #666;
        font-weight: 400;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: #999;
        cursor: pointer;
        line-height: 1;
    }

    .modal-close:hover {
        color: #333;
    }

    .modal-body {
        padding: 20px;
    }

    /* Template Select */
    .template-section {
        margin-bottom: 16px;
        padding-bottom: 16px;
        border-bottom: 1px solid #eee;
    }

    .template-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: #666;
        margin-bottom: 8px;
        display: block;
    }

    .template-btns {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }

    .template-btn {
        padding: 6px 12px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        background: #fff;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.15s;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .template-btn:hover {
        border-color: #2196f3;
        background: #e3f2fd;
    }

    .template-btn .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    /* Form */
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 16px;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .form-group:last-child {
        margin-bottom: 0;
    }

    .form-label {
        display: block;
        font-size: 0.75rem;
        font-weight: 600;
        color: #666;
        margin-bottom: 6px;
    }

    .form-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        font-size: 0.9rem;
    }

    .form-input:focus {
        outline: none;
        border-color: #2196f3;
    }

    .checkbox-row {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        background: #f5f5f5;
        border-radius: 8px;
        cursor: pointer;
    }

    .checkbox-row input {
        width: 18px;
        height: 18px;
    }

    .checkbox-row span {
        font-size: 0.85rem;
        color: #333;
    }

    .modal-footer {
        padding: 16px 20px;
        border-top: 1px solid #eee;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }

    .btn {
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.15s;
    }

    .btn-cancel {
        background: #f5f5f5;
        color: #333;
    }

    .btn-cancel:hover {
        background: #eee;
    }

    .btn-save {
        background: #2196f3;
        color: #fff;
    }

    .btn-save:hover {
        background: #1976d2;
    }

    .btn-delete {
        background: #ffebee;
        color: #e53935;
        margin-right: auto;
    }

    .btn-delete:hover {
        background: #ffcdd2;
    }

    /* Empty State */
    .empty-box {
        text-align: center;
        padding: 60px 20px;
        background: #fff;
        border-radius: 12px;
        border: 1px solid #e0e0e0;
    }

    .empty-box h3 {
        color: #333;
        margin: 16px 0 8px;
    }

    .empty-box p {
        color: #666;
        margin-bottom: 20px;
    }

    @@media (max-width: 768px) {
        .att-page { padding: 12px; }
        .att-header { flex-direction: column; align-items: stretch; }
        .modal-box { max-width: 100%; }
    }
</style>

<div class="att-page">
    <div class="att-header">
        <h1 class="att-title">üïê @(isTurkish ? "Mesai Takip" : "Attendance")</h1>
        
        <div class="att-nav">
            <div class="month-picker">
                <a href="@Url.Action("Attendance", new { year = Model.SelectedMonth == 1 ? Model.SelectedYear - 1 : Model.SelectedYear, month = Model.SelectedMonth == 1 ? 12 : Model.SelectedMonth - 1 })">‚Äπ</a>
                <span class="month-text">@Model.MonthName</span>
                <a href="@Url.Action("Attendance", new { year = Model.SelectedMonth == 12 ? Model.SelectedYear + 1 : Model.SelectedYear, month = Model.SelectedMonth == 12 ? 1 : Model.SelectedMonth + 1 })">‚Ä∫</a>
            </div>
            <a href="@Url.Action("Index", new { year = Model.SelectedYear, month = Model.SelectedMonth })" class="btn-back">‚Üê @(isTurkish ? "Takvim" : "Calendar")</a>
        </div>
    </div>

    @if (Model.Employees.Any())
    {
        <div class="att-card">
            <div class="att-scroll">
                <table class="att-table">
                    <thead>
                        <tr>
                            <th class="emp-col">@(isTurkish ? "Personel" : "Employee")</th>
                            @for (int day = 1; day <= Model.DaysInMonth; day++)
                            {
                                var date = new DateOnly(Model.SelectedYear, Model.SelectedMonth, day);
                                var isWeekend = Model.IsWeekend(date);
                                var isHoliday = Model.IsHoliday(date);
                                var colClass = "day-col" + (isHoliday ? " holiday" : (isWeekend ? " weekend" : ""));
                                <th class="@colClass">
                                    <div class="day-num">@day</div>
                                    <div class="day-name">@dayNames[(int)date.DayOfWeek]</div>
                                </th>
                            }
                            <th style="min-width:70px;">@(isTurkish ? "Toplam" : "Total")</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var employee in Model.Employees)
                        {
                            var totalWorked = Model.Attendances
                                .Where(a => a.EmployeeId == employee.Id && a.WorkedHours.HasValue)
                                .Sum(a => a.WorkedHours ?? 0);
                            var daysWorked = Model.Attendances
                                .Count(a => a.EmployeeId == employee.Id && a.CheckInTime.HasValue);
                            
                            <tr>
                                <td class="emp-cell">
                                    <div class="emp-name">@employee.FullName</div>
                                    @if (!string.IsNullOrEmpty(employee.Title))
                                    {
                                        <div class="emp-role">@employee.Title</div>
                                    }
                                </td>
                                @for (int day = 1; day <= Model.DaysInMonth; day++)
                                {
                                    var date = new DateOnly(Model.SelectedYear, Model.SelectedMonth, day);
                                    var attendance = Model.GetAttendance(employee.Id, date);
                                    var shift = Model.GetShift(employee.Id, date);
                                    var isWeekend = Model.IsWeekend(date);
                                    var isHoliday = Model.IsHoliday(date);
                                    
                                    var cellClass = "att-cell";
                                    if (isHoliday) cellClass += " holiday";
                                    else if (isWeekend) cellClass += " weekend";
                                    
                                    var shiftStart = shift?.StartTime.ToString("HH:mm") ?? "";
                                    var shiftEnd = shift?.EndTime.ToString("HH:mm") ?? "";
                                    var shiftSpans = shift?.SpansNextDay ?? false;
                                    
                                    <td class="@cellClass" 
                                        onclick="openModal({
                                            empId: @employee.Id,
                                            empName: '@employee.FullName.Replace("'", "\\'")',
                                            date: '@date.ToString("yyyy-MM-dd")',
                                            attId: @(attendance?.Id ?? 0),
                                            checkIn: '@(attendance?.CheckInTime?.ToString("HH:mm") ?? "")',
                                            checkOut: '@(attendance?.CheckOutTime?.ToString("HH:mm") ?? "")',
                                            nextDay: @(attendance?.CheckOutToNextDay.ToString().ToLower() ?? "false"),
                                            notes: '@(attendance?.Notes?.Replace("'", "\\'").Replace("\n", "\\n") ?? "")',
                                            shiftStart: '@shiftStart',
                                            shiftEnd: '@shiftEnd',
                                            shiftSpans: @shiftSpans.ToString().ToLower()
                                        })">
                                        <div class="cell-inner">
                                            @* N√∂bet Saatleri *@
                                            @if (shift != null && !shift.IsDayOff)
                                            {
                                                <div class="shift-box">
                                                    <div class="shift-label">@(isTurkish ? "N√∂bet" : "Shift")</div>
                                                    <div class="shift-time">
                                                        @shift.StartTime.ToString("HH:mm") - @shift.EndTime.ToString("HH:mm")
                                                        @if (shift.SpansNextDay) { <span style="color:#e91e63;">‚Üì</span> }
                                                    </div>
                                                </div>
                                            }
                                            
                                            @* Giri≈ü/√áƒ±kƒ±≈ü Saatleri *@
                                            @if (attendance?.CheckInTime != null || attendance?.CheckOutTime != null)
                                            {
                                                <div class="attendance-box">
                                                    @if (attendance?.CheckInTime != null)
                                                    {
                                                        <div class="time-row check-in">
                                                            <span class="icon">‚Üì</span>
                                                            <span>@attendance.CheckInTime.Value.ToString("HH:mm")</span>
                                                        </div>
                                                    }
                                                    @if (attendance?.CheckOutTime != null)
                                                    {
                                                        <div class="time-row check-out">
                                                            <span class="icon">‚Üë</span>
                                                            <span>@attendance.CheckOutTime.Value.ToString("HH:mm")</span>
                                                            @if (attendance.CheckOutToNextDay) { <span style="font-size:0.6rem;">+1</span> }
                                                        </div>
                                                    }
                                                </div>
                                            }
                                            
                                            @* √áalƒ±≈üƒ±lan Saat *@
                                            @if (attendance?.WorkedHours > 0)
                                            {
                                                <div class="worked-box">
                                                    <span>@attendance.WorkedHours.Value.ToString("0.#") @(isTurkish ? "saat" : "hrs")</span>
                                                </div>
                                            }
                                            
                                            @* Bo≈ü *@
                                            @if (attendance == null && shift == null)
                                            {
                                                <div class="empty-hint">+</div>
                                            }
                                        </div>
                                    </td>
                                }
                                <td class="summary-cell">
                                    <div class="summary-hours">@totalWorked.ToString("0.#")</div>
                                    <div class="summary-days">@daysWorked @(isTurkish ? "g√ºn" : "days")</div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="empty-box">
            <div style="font-size:3rem;">üë§</div>
            <h3>@(isTurkish ? "Hen√ºz personel yok" : "No employees yet")</h3>
            <p>@(isTurkish ? "Mesai takibi i√ßin √∂nce personel ekleyin." : "Add employees first.")</p>
            <a href="@Url.Action("Index")" class="btn btn-save">@(isTurkish ? "Takvime Git" : "Go to Calendar")</a>
        </div>
    }
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal">
    <div class="modal-box">
        <div class="modal-header">
            <h3 id="modalTitle">@(isTurkish ? "Mesai Kaydƒ±" : "Attendance")</h3>
            <button class="modal-close" onclick="closeModal()">√ó</button>
        </div>
        
        <div class="modal-body">
            <input type="hidden" id="attId">
            <input type="hidden" id="empId">
            <input type="hidden" id="attDate">
            
            <!-- ≈ûablon Se√ßimi -->
            <div class="template-section">
                <label class="template-label">@(isTurkish ? "≈ûablondan Ata" : "Apply Template")</label>
                <div class="template-btns" id="templateBtns">
                    @foreach (var tpl in shiftTemplates.Where(t => t.IsActive))
                    {
                        <button type="button" class="template-btn" 
                                onclick="applyTemplate('@tpl.StartTime.ToString("HH:mm")', '@tpl.EndTime.ToString("HH:mm")', @tpl.SpansNextDay.ToString().ToLower())">
                            <span class="dot" style="background:@tpl.Color"></span>
                            @tpl.Name
                        </button>
                    }
                    <button type="button" class="template-btn" id="shiftTemplateBtn" style="display:none;" 
                            onclick="applyShiftTemplate()">
                        <span class="dot" style="background:#2196f3"></span>
                        <span id="shiftTemplateText">@(isTurkish ? "N√∂bet Saati" : "Shift Time")</span>
                    </button>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group" style="margin-bottom:0;">
                    <label class="form-label">@(isTurkish ? "Giri≈ü Saati" : "Check In")</label>
                    <input type="time" class="form-input" id="timeIn">
                </div>
                <div class="form-group" style="margin-bottom:0;">
                    <label class="form-label">@(isTurkish ? "√áƒ±kƒ±≈ü Saati" : "Check Out")</label>
                    <input type="time" class="form-input" id="timeOut">
                </div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-row">
                    <input type="checkbox" id="nextDay">
                    <span>@(isTurkish ? "√áƒ±kƒ±≈ü ertesi g√ºne sarkar" : "Check out next day")</span>
                </label>
            </div>
            
            <div class="form-group">
                <label class="form-label">@(isTurkish ? "Not" : "Notes")</label>
                <textarea class="form-input" id="notes" rows="2"></textarea>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-delete" id="deleteBtn" onclick="deleteRecord()" style="display:none;">
                @(isTurkish ? "Sil" : "Delete")
            </button>
            <button class="btn btn-cancel" onclick="closeModal()">@(isTurkish ? "ƒ∞ptal" : "Cancel")</button>
            <button class="btn btn-save" onclick="saveRecord()">@(isTurkish ? "Kaydet" : "Save")</button>
        </div>
    </div>
</div>

<script>
    let currentShiftStart = '';
    let currentShiftEnd = '';
    let currentShiftSpans = false;
    let originalCheckIn = '';
    let originalCheckOut = '';

    function closeModal() {
        document.getElementById('modal').classList.remove('active');
    }
    
    function applyTemplate(start, end, spans) {
        document.getElementById('timeIn').value = start;
        document.getElementById('timeOut').value = end;
        document.getElementById('nextDay').checked = spans;
    }
    
    function applyShiftTemplate() {
        if (currentShiftStart && currentShiftEnd) {
            applyTemplate(currentShiftStart, currentShiftEnd, currentShiftSpans);
        }
    }

    function openModal(data) {
        document.getElementById('empId').value = data.empId;
        document.getElementById('attDate').value = data.date;
        document.getElementById('attId').value = data.attId || 0;
        document.getElementById('timeIn').value = data.checkIn || '';
        document.getElementById('timeOut').value = data.checkOut || '';
        document.getElementById('nextDay').checked = data.nextDay;
        document.getElementById('notes').value = data.notes || '';
        
        // Store original values to detect clearing
        originalCheckIn = data.checkIn || '';
        originalCheckOut = data.checkOut || '';
        
        // N√∂bet saati varsa ≈üablon butonu g√∂ster
        currentShiftStart = data.shiftStart || '';
        currentShiftEnd = data.shiftEnd || '';
        currentShiftSpans = data.shiftSpans || false;
        
        const shiftBtn = document.getElementById('shiftTemplateBtn');
        if (currentShiftStart && currentShiftEnd) {
            shiftBtn.style.display = 'flex';
            document.getElementById('shiftTemplateText').textContent = currentShiftStart + ' - ' + currentShiftEnd;
        } else {
            shiftBtn.style.display = 'none';
        }
        
        document.getElementById('modalTitle').innerHTML = data.empName + ' <small style="color:#666;">(' + data.date + ')</small>';
        document.getElementById('deleteBtn').style.display = data.attId > 0 ? 'block' : 'none';
        
        document.getElementById('modal').classList.add('active');
    }

    async function saveRecord() {
        const checkIn = document.getElementById('timeIn').value || null;
        const checkOut = document.getElementById('timeOut').value || null;
        const attId = document.getElementById('attId').value;
        
        // For new records, at least one time is required
        if (!attId || attId === '0') {
            if (!checkIn && !checkOut) {
                alert('@(isTurkish ? "En az giri≈ü veya √ßƒ±kƒ±≈ü saati giriniz" : "Enter at least check-in or check-out time")');
                return;
            }
        }
        
        const data = {
            employeeId: parseInt(document.getElementById('empId').value),
            date: document.getElementById('attDate').value,
            checkInTime: checkIn,
            checkOutTime: checkOut,
            checkOutToNextDay: document.getElementById('nextDay').checked,
            clearCheckIn: originalCheckIn && !checkIn, // Was set, now empty
            clearCheckOut: originalCheckOut && !checkOut, // Was set, now empty
            notes: document.getElementById('notes').value || null,
            type: 0
        };

        try {
            const res = await fetch('/api/attendance/manual', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await res.json();
            if (result.success) {
                closeModal();
                location.reload();
            } else {
                alert(result.error || '@(isTurkish ? "Hata" : "Error")');
            }
        } catch (e) {
            alert('@(isTurkish ? "Baƒülantƒ± hatasƒ±" : "Connection error")');
        }
    }

    async function deleteRecord() {
        const id = document.getElementById('attId').value;
        if (!id || id === '0') return;
        if (!confirm('@(isTurkish ? "Bu kaydƒ± silmek istediƒüinizden emin misiniz?" : "Delete this record?")')) return;

        try {
            const res = await fetch('/api/attendance/' + id, { method: 'DELETE' });
            const result = await res.json();
            if (result.success) {
                closeModal();
                location.reload();
            }
        } catch (e) {
            alert('@(isTurkish ? "Hata" : "Error")');
        }
    }

    document.getElementById('modal').addEventListener('click', e => { if (e.target.id === 'modal') closeModal(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
</script>
