@model AdminStatsViewModel
@using Nobetci.Web.Models
@{
    ViewData["Title"] = "Ä°statistikler";
    Layout = "_AdminLayout";
}

<div class="admin-header">
    <h2>
        <span>ğŸ“ˆ</span>
        Ä°statistikler
    </h2>
    <div class="header-actions">
        <a href="/admin/logs" class="btn btn-secondary">
            <span>ğŸ“‹</span>
            DetaylÄ± Loglar
        </a>
    </div>
</div>

<!-- Ziyaret Ä°statistikleri -->
<div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
    <div class="stat-card" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-color: #60a5fa;">
        <span class="stat-icon">ğŸ‘ï¸</span>
        <div class="stat-label" style="color: #1e40af;">BugÃ¼n</div>
        <div class="stat-value" style="color: #1e3a8a;">@Model.TodayVisits.ToString("N0")</div>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-color: #34d399;">
        <span class="stat-icon">ğŸ“…</span>
        <div class="stat-label" style="color: #065f46;">Bu Hafta</div>
        <div class="stat-value" style="color: #064e3b;">@Model.WeekVisits.ToString("N0")</div>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-color: #fbbf24;">
        <span class="stat-icon">ğŸ“†</span>
        <div class="stat-label" style="color: #92400e;">Bu Ay</div>
        <div class="stat-value" style="color: #78350f;">@Model.MonthVisits.ToString("N0")</div>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); border-color: #a78bfa;">
        <span class="stat-icon">ğŸ“Š</span>
        <div class="stat-label" style="color: #5b21b6;">Toplam</div>
        <div class="stat-value" style="color: #4c1d95;">@Model.TotalVisits.ToString("N0")</div>
    </div>
</div>

<!-- DiÄŸer Ä°statistikler -->
<div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
    <div class="stat-card">
        <span class="stat-icon">ğŸŒ</span>
        <div class="stat-label">Unique IP</div>
        <div class="stat-value">@Model.UniqueIPs.ToString("N0")</div>
    </div>
    
    <div class="stat-card">
        <span class="stat-icon">ğŸ“„</span>
        <div class="stat-label">Toplam Sayfa</div>
        <div class="stat-value">@Model.TotalPages</div>
    </div>
    
    <div class="stat-card">
        <span class="stat-icon">âœ…</span>
        <div class="stat-label">YayÄ±ndaki Sayfa</div>
        <div class="stat-value">@Model.PublishedPages</div>
    </div>
    
    <div class="stat-card">
        <span class="stat-icon">ğŸ¢</span>
        <div class="stat-label">Toplam Organizasyon</div>
        <div class="stat-value">@Model.TotalOrganizations</div>
    </div>
</div>

<div class="grid-2">
    <!-- En Ã‡ok Ziyaret Edilen Sayfalar -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">
                <span>ğŸ”¥</span>
                En Ã‡ok Ziyaret Edilen Sayfalar
            </span>
        </div>
        @if (Model.TopPages.Any())
        {
            <table class="table">
                <thead>
                    <tr>
                        <th>Sayfa</th>
                        <th style="text-align: right;">Ziyaret</th>
                    </tr>
                </thead>
                <tbody>
                    @{ var maxVisits = Model.TopPages.Max(p => p.Count); }
                    @foreach (var pg in Model.TopPages)
                    {
                        var percentage = maxVisits > 0 ? (pg.Count * 100.0 / maxVisits) : 0;
                        <tr>
                            <td>
                                <div class="truncate" style="max-width: 250px;" title="@pg.Path">@pg.Path</div>
                                <div style="margin-top: 6px; height: 4px; background: #e2e8f0; border-radius: 2px; overflow: hidden;">
                                    <div style="width: @percentage%; height: 100%; background: linear-gradient(90deg, #6366f1, #8b5cf6); border-radius: 2px;"></div>
                                </div>
                            </td>
                            <td style="text-align: right;">
                                <span class="badge badge-info">@pg.Count.ToString("N0")</span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="empty-state">
                <div class="icon">ğŸ“Š</div>
                <div class="title">HenÃ¼z veri yok</div>
            </div>
        }
    </div>
    
    <!-- Cihaz DaÄŸÄ±lÄ±mÄ± -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">
                <span>ğŸ“±</span>
                Cihaz DaÄŸÄ±lÄ±mÄ±
            </span>
        </div>
        @if (Model.DeviceStats.Any())
        {
            <div style="display: flex; flex-direction: column; gap: 16px;">
                @{
                    var totalDevices = Model.DeviceStats.Sum(d => d.Count);
                    var deviceColors = new Dictionary<string, string>
                    {
                        { "Desktop", "#6366f1" },
                        { "Mobile", "#10b981" },
                        { "Tablet", "#f59e0b" },
                        { "Bot", "#64748b" }
                    };
                }
                @foreach (var device in Model.DeviceStats)
                {
                    var icon = device.Type switch
                    {
                        "Desktop" => "ğŸ–¥ï¸",
                        "Mobile" => "ğŸ“±",
                        "Tablet" => "ğŸ“²",
                        "Bot" => "ğŸ¤–",
                        _ => "â“"
                    };
                    var percentage = totalDevices > 0 ? (device.Count * 100.0 / totalDevices) : 0;
                    var color = deviceColors.GetValueOrDefault(device.Type, "#94a3b8");
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">@icon</span>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span style="font-weight: 600; color: var(--text-primary);">@device.Type</span>
                                <span style="font-size: 0.85rem; color: var(--text-secondary);">@device.Count.ToString("N0") (%@percentage.ToString("F1"))</span>
                            </div>
                            <div style="height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                                <div style="width: @percentage%; height: 100%; background: @color; border-radius: 4px; transition: width 0.5s ease;"></div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="icon">ğŸ“±</div>
                <div class="title">HenÃ¼z veri yok</div>
            </div>
        }
    </div>
</div>

<!-- Browser DaÄŸÄ±lÄ±mÄ± -->
<div class="card">
    <div class="card-header">
        <span class="card-title">
            <span>ğŸŒ</span>
            Browser DaÄŸÄ±lÄ±mÄ±
        </span>
    </div>
    @if (Model.BrowserStats.Any())
    {
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            @{
                var totalBrowsers = Model.BrowserStats.Sum(b => b.Count);
                var browserColors = new[] { "#6366f1", "#10b981", "#f59e0b", "#ef4444", "#8b5cf6" };
                var colorIndex = 0;
            }
            @foreach (var browser in Model.BrowserStats)
            {
                var percentage = totalBrowsers > 0 ? (browser.Count * 100.0 / totalBrowsers) : 0;
                var color = browserColors[colorIndex % browserColors.Length];
                colorIndex++;
                <div style="background: var(--bg-main); padding: 16px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span style="font-weight: 700; color: var(--text-primary);">@browser.Name</span>
                        <span class="badge" style="background: @color; color: white;">%@percentage.ToString("F1")</span>
                    </div>
                    <div style="font-size: 1.5rem; font-weight: 800; color: @color; margin-bottom: 8px;">@browser.Count.ToString("N0")</div>
                    <div style="height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                        <div style="width: @percentage%; height: 100%; background: @color; border-radius: 3px;"></div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state">
            <div class="icon">ğŸŒ</div>
            <div class="title">HenÃ¼z veri yok</div>
        </div>
    }
</div>
