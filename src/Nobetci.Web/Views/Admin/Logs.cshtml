@model List<Nobetci.Web.Data.Entities.VisitorLog>
@{
    ViewData["Title"] = "Ziyaret√ßi Loglarƒ±";
    Layout = "_AdminLayout";
}

<div class="admin-header">
    <h2>
        <span>üìã</span>
        Ziyaret√ßi Loglarƒ±
    </h2>
    <div class="header-actions">
        <span class="badge badge-info" style="font-size: 0.8rem; padding: 8px 14px;">
            Toplam: @ViewBag.TotalItems.ToString("N0") kayƒ±t
        </span>
    </div>
</div>

<div class="card">
    <form method="get" class="filter-bar">
        <div class="filter-group">
            <label>Arama</label>
            <input type="text" name="search" value="@ViewBag.Search" placeholder="IP, URL, Browser...">
        </div>
        
        <div class="filter-group">
            <label>Cihaz</label>
            <select name="deviceType">
                <option value="">T√ºm√º</option>
                <option value="Desktop" selected="@(ViewBag.DeviceType == "Desktop")">üñ•Ô∏è Desktop</option>
                <option value="Mobile" selected="@(ViewBag.DeviceType == "Mobile")">üì± Mobile</option>
                <option value="Tablet" selected="@(ViewBag.DeviceType == "Tablet")">üì≤ Tablet</option>
                <option value="Bot" selected="@(ViewBag.DeviceType == "Bot")">ü§ñ Bot</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label>Ba≈ülangƒ±√ß</label>
            <input type="date" name="dateFrom" value="@ViewBag.DateFrom">
        </div>
        
        <div class="filter-group">
            <label>Biti≈ü</label>
            <input type="date" name="dateTo" value="@ViewBag.DateTo">
        </div>
        
        <button type="submit" class="btn btn-primary">
            <span>üîç</span>
            Filtrele
        </button>
        <a href="/admin/logs" class="btn btn-secondary">Temizle</a>
    </form>
</div>

<div class="card" style="padding: 0; overflow: hidden;">
    <div style="overflow-x: auto;">
        <table class="table" style="margin: 0;">
            <thead>
                <tr>
                    <th style="padding-left: 20px;">Tarih</th>
                    <th>IP Adresi</th>
                    <th>Sayfa</th>
                    <th>Browser</th>
                    <th style="text-align: center;">Cihaz</th>
                    <th>ƒ∞≈ületim Sistemi</th>
                    <th style="text-align: center;">S√ºre</th>
                    <th style="text-align: center; padding-right: 20px;">Durum</th>
                </tr>
            </thead>
            <tbody>
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="8">
                            <div class="empty-state" style="padding: 60px 20px;">
                                <div class="icon">üìã</div>
                                <div class="title">Log kaydƒ± bulunamadƒ±</div>
                                <p style="color: var(--text-muted); margin-top: 8px;">Filtreleri deƒüi≈ütirerek tekrar deneyin</p>
                            </div>
                        </td>
                    </tr>
                }
                @foreach (var log in Model)
                {
                    <tr>
                        <td style="white-space: nowrap; padding-left: 20px;">
                            <div style="font-weight: 600; font-size: 0.85rem;">@log.CreatedAt.ToLocalTime().ToString("dd MMM")</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">@log.CreatedAt.ToLocalTime().ToString("HH:mm:ss")</div>
                        </td>
                        <td>
                            <code style="font-size: 0.8rem; background: var(--bg-main); padding: 4px 8px; border-radius: 4px; font-family: 'SF Mono', Monaco, monospace;">@log.IpAddress</code>
                        </td>
                        <td>
                            <div class="truncate" style="max-width: 280px; font-weight: 500;" title="@log.PagePath">
                                @log.PagePath
                            </div>
                            @if (!string.IsNullOrEmpty(log.Referrer))
                            {
                                <div class="truncate" style="max-width: 200px; font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;" title="@log.Referrer">
                                    ‚Üê @log.Referrer
                                </div>
                            }
                        </td>
                        <td style="font-size: 0.85rem;">
                            <div style="font-weight: 500;">@log.Browser</div>
                            @if (!string.IsNullOrEmpty(log.BrowserVersion))
                            {
                                <div style="font-size: 0.75rem; color: var(--text-muted);">v@log.BrowserVersion</div>
                            }
                        </td>
                        <td style="text-align: center;">
                            @{
                                var deviceIcon = log.DeviceType switch
                                {
                                    "Desktop" => "üñ•Ô∏è",
                                    "Mobile" => "üì±",
                                    "Tablet" => "üì≤",
                                    "Bot" => "ü§ñ",
                                    _ => "‚ùì"
                                };
                            }
                            <span style="font-size: 1.4rem;" title="@log.DeviceType">@deviceIcon</span>
                        </td>
                        <td style="font-size: 0.85rem; color: var(--text-secondary);">
                            @log.OperatingSystem
                        </td>
                        <td style="text-align: center;">
                            @if (log.ResponseTimeMs.HasValue)
                            {
                                var speedClass = log.ResponseTimeMs < 200 ? "badge-success" : log.ResponseTimeMs < 1000 ? "badge-warning" : "badge-danger";
                                <span class="badge @speedClass" style="font-family: 'SF Mono', Monaco, monospace;">
                                    @log.ResponseTimeMs ms
                                </span>
                            }
                            else
                            {
                                <span style="color: var(--text-muted);">‚Äî</span>
                            }
                        </td>
                        <td style="text-align: center; padding-right: 20px;">
                            @if (log.StatusCode.HasValue)
                            {
                                var statusClass = log.StatusCode switch
                                {
                                    >= 200 and < 300 => "badge-success",
                                    >= 300 and < 400 => "badge-info",
                                    >= 400 and < 500 => "badge-warning",
                                    >= 500 => "badge-danger",
                                    _ => "badge-info"
                                };
                                <span class="badge @statusClass">@log.StatusCode</span>
                            }
                            else
                            {
                                <span style="color: var(--text-muted);">‚Äî</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    
    @if (ViewBag.TotalPages > 1)
    {
        <div style="padding: 20px; border-top: 1px solid var(--border-color);">
            <div class="pagination">
                @if (ViewBag.CurrentPage > 1)
                {
                    <a href="/admin/logs?page=@(ViewBag.CurrentPage - 1)&search=@ViewBag.Search&deviceType=@ViewBag.DeviceType&dateFrom=@ViewBag.DateFrom&dateTo=@ViewBag.DateTo" class="page-link">
                        ‚Üê √ñnceki
                    </a>
                }
                else
                {
                    <span class="page-link disabled">‚Üê √ñnceki</span>
                }
                
                @{
                    var startPage = Math.Max(1, ViewBag.CurrentPage - 2);
                    var endPage = Math.Min(ViewBag.TotalPages, ViewBag.CurrentPage + 2);
                }
                
                @if (startPage > 1)
                {
                    <a href="/admin/logs?page=1&search=@ViewBag.Search&deviceType=@ViewBag.DeviceType&dateFrom=@ViewBag.DateFrom&dateTo=@ViewBag.DateTo" class="page-link">1</a>
                    @if (startPage > 2)
                    {
                        <span class="page-link disabled">‚Ä¢‚Ä¢‚Ä¢</span>
                    }
                }
                
                @for (int i = startPage; i <= endPage; i++)
                {
                    <a href="/admin/logs?page=@i&search=@ViewBag.Search&deviceType=@ViewBag.DeviceType&dateFrom=@ViewBag.DateFrom&dateTo=@ViewBag.DateTo" 
                       class="page-link @(i == ViewBag.CurrentPage ? "active" : "")">@i</a>
                }
                
                @if (endPage < ViewBag.TotalPages)
                {
                    @if (endPage < ViewBag.TotalPages - 1)
                    {
                        <span class="page-link disabled">‚Ä¢‚Ä¢‚Ä¢</span>
                    }
                    <a href="/admin/logs?page=@ViewBag.TotalPages&search=@ViewBag.Search&deviceType=@ViewBag.DeviceType&dateFrom=@ViewBag.DateFrom&dateTo=@ViewBag.DateTo" class="page-link">@ViewBag.TotalPages</a>
                }
                
                @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                {
                    <a href="/admin/logs?page=@(ViewBag.CurrentPage + 1)&search=@ViewBag.Search&deviceType=@ViewBag.DeviceType&dateFrom=@ViewBag.DateFrom&dateTo=@ViewBag.DateTo" class="page-link">
                        Sonraki ‚Üí
                    </a>
                }
                else
                {
                    <span class="page-link disabled">Sonraki ‚Üí</span>
                }
            </div>
        </div>
    }
</div>
